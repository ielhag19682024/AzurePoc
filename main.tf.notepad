{"bgColorIndex":0,"note":"provider \"azurerm\" {\n  features {}\n  subscription_id = \"fa506ae2-e174-47a9-bafa-af7b0eefa394\"\n}\n\nvariable \"resource_group\" {\n  default = \"azure-infra-architecture\"\n}\n\nvariable \"location\" {\n  default = \"East US\"\n}\n\nvariable \"admin_username\" {\n  default = \"azureuser\"\n}\n\nvariable \"admin_password\" {\n  default = \"P@ssw0rd1234!\"\n}\n\nvariable \"vm_size\" {\n  default = \"Standard_B2s\"\n}\n\nresource \"azurerm_resource_group\" \"rg\" {\n  name     = var.resource_group\n  location = var.location\n}\n\nresource \"azurerm_virtual_network\" \"vnet\" {\n  name                = \"azure-vnet\"\n  address_space       = [\"10.0.0.0\/16\"]\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n}\n\nresource \"azurerm_subnet\" \"subnet\" {\n  name                 = \"default\"\n  resource_group_name  = azurerm_resource_group.rg.name\n  virtual_network_name = azurerm_virtual_network.vnet.name\n  address_prefixes     = [\"10.0.1.0\/24\"]\n}\n\nresource \"azurerm_network_security_group\" \"nsg\" {\n  name                = \"web-app-db-nsg\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  security_rule {\n    name                       = \"allow_ssh\"\n    priority                   = 100\n    direction                  = \"Inbound\"\n    access                     = \"Allow\"\n    protocol                   = \"Tcp\"\n    source_port_range          = \"*\"\n    destination_port_range     = \"22\"\n    source_address_prefix      = \"*\"\n    destination_address_prefix = \"*\"\n  }\n}\n\nresource \"azurerm_network_interface\" \"web\" {\n  name                = \"web-nic\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.subnet.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n}\n\nresource \"azurerm_windows_virtual_machine\" \"web_vm\" {\n  name                = \"web-server\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = var.vm_size\n  admin_username      = var.admin_username\n  admin_password      = var.admin_password\n\n  network_interface_ids = [\n    azurerm_network_interface.web.id,\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"MicrosoftWindowsServer\"\n    offer     = \"WindowsServer\"\n    sku       = \"2019-Datacenter\"\n    version   = \"latest\"\n  }\n}\n\nresource \"azurerm_virtual_machine_extension\" \"web_vm\" {\n  name                 = \"web-extension\"\n  virtual_machine_id   = azurerm_windows_virtual_machine.web_vm.id\n  publisher            = \"Microsoft.Compute\"\n  type                 = \"CustomScriptExtension\"\n  type_handler_version = \"1.10\"\n\n  settings = <<SETTINGS\n    {\n      \"commandToExecute\": \"powershell -Command \\\"Install-PackageProvider -Name NuGet -Force; Install-Module -Name 'NodeJs' -RequiredVersion '22.0'\\\"\"\n    }\n  SETTINGS\n}\n\nresource \"azurerm_network_interface\" \"db\" {\n  name                = \"db-nic\"\n  location            = azurerm_resource_group.rg.location\n  resource_group_name = azurerm_resource_group.rg.name\n\n  ip_configuration {\n    name                          = \"internal\"\n    subnet_id                     = azurerm_subnet.subnet.id\n    private_ip_address_allocation = \"Dynamic\"\n  }\n}\n\nresource \"azurerm_linux_virtual_machine\" \"db_vm\" {\n  name                = \"db-server\"\n  resource_group_name = azurerm_resource_group.rg.name\n  location            = azurerm_resource_group.rg.location\n  size                = var.vm_size\n  admin_username      = var.admin_username\n  admin_password      = var.admin_password\n\n  network_interface_ids = [\n    azurerm_network_interface.db.id,\n  ]\n\n  os_disk {\n    caching              = \"ReadWrite\"\n    storage_account_type = \"Standard_LRS\"\n  }\n\n  source_image_reference {\n    publisher = \"RedHat\"\n    offer     = \"RHEL\"\n    sku       = \"9-RAW\"\n    version   = \"latest\"\n  }\n}\n\nresource \"azurerm_virtual_machine_extension\" \"db_extension\" {\n  name                 = \"db-extension\"\n  virtual_machine_id   = azurerm_linux_virtual_machine.db_vm.id\n  publisher            = \"Microsoft.Compute\"\n  type                 = \"CustomScript\"\n  type_handler_version = \"1.10\"\n\n  settings = <<SETTINGS\n    {\n      \"commandToExecute\": \"bash -c 'sudo apt-get update; sudo apt-get install mssql-server -y'\"\n    }\n  SETTINGS\n}\n","textColorIndex":0}